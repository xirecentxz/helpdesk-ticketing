<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0f172a; color: #f8fafc; padding: 20px; }
    .container { max-width: 900px; margin: auto; background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; border: 1px solid rgba(255,255,255,0.1); }
    h2 { color: #38bdf8; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 12px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.1); font-size: 0.9rem; }
    th { color: #38bdf8; background: rgba(56, 189, 248, 0.1); }
    .btn { background: #38bdf8; border: none; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; color: #0f172a; }
    .btn-close { background: #f87171; color: white; }
    .status-open { color: #4ade80; font-weight: bold; }
    .status-closed { color: #94a3b8; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Admin <span style="color:white">Dashboard</span></h2>
    <button class="btn" onclick="loadData()">Refresh Data</button>
    <table id="ticketTable">
      <thead>
        <tr><th>ID</th><th>Pelapor</th><th>Masalah</th><th>Status</th><th>Aksi</th></tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>

  <script>
    function loadData() {
      document.getElementById('tableBody').innerHTML = "<tr><td colspan='5'>Memuat data...</td></tr>";
      google.script.run.withSuccessHandler(renderTable).getTickets();
    }

    function renderTable(tickets) {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = tickets.reverse().map(row => `
        <tr>
          <td>${row[0]}</td>
          <td>${row[2]}</td>
          <td>${row[6]}</td>
          <td class="${row[9] === 'Open' ? 'status-open' : 'status-closed'}">${row[9]}</td>
          <td>
            ${row[9] === 'Open' ? `<button class="btn btn-close" onclick="closeTicket('${row[0]}')">Close</button>` : 'âœ…'}
          </td>
        </tr>
      `).join('');
    }

    function closeTicket(id) {
      const note = prompt("Berikan catatan penyelesaian untuk tiket " + id + ":");
      if (note) {
        google.script.run.withSuccessHandler(() => {
          alert("Tiket " + id + " ditutup!");
          loadData();
        }).updateTicketStatus(id, note);
      }
    }
    window.onload = loadData;
  </script>
</body>
</html>
